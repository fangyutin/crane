# crane
For Use in Logistics Technology Competitions
基于YOLOv5与树莓派的货箱（Box）与纸垛（Stack）视觉识别系统，实现实时物体检测、结果处理与串口通信。

# 个人贡献
①负责完成拍照、打标等数据集制作工作，并在光影、噪点上进一步拓展了数据集。
②通过租借云服务器，在云服务器上分别训练了针对纸垛、货箱的识别模型（在model文件夹中），并能实现较高的置信度。
（在未突发因素遮挡、正常赛场光线的情况下，可以直接输出准确结果）
（同时，经过试验，在kb104只开离场地最远的一盏灯/阳光直射情况下打伞遮挡识别数字的环境下，识别结果均不受影响）
③设计了较严谨的识别逻辑，通过精准划分图像区域、重复结果处理、随机补全等逻辑，保证识别的准确性，也防止因为识别原因造成机构“一动不动”的情况。
④通过ai帮助，完成树莓派端的图像采集、数码变焦、串口通信等功能，并部署为开机自启动服务。
⑤尝试对YOLOv5原生`detect.py`进行模型加载优化（虽未完全成功）。



# 代码结构解释

 核心函数
1、图像处理函数：
apply_digital_zoom(): 应用数码变焦，裁剪并放大图像特定区域
capture_image(): 捕获单张图像，包含预热帧处理
2、检测处理函数
load_class_names(): 从YAML文件加载YOLO类别名称
get_detected_labels(): 处理检测结果，按六个固定区域分析，读取图像特定位置的识别结果（防止因为场外因素遮挡识别，导致某一特定区域没有识别到，同时按固定区域获得的结果顺序会比单纯的从左到右排序准确率更高））
get_norepeat_string_box(): 处理货箱识别结果，确保六个区域标识符无重复数字
get_norepeat_string():处理纸垛识别结果，保证有五个不重复数字和一个字母
3、检测流程函数
detect_single_image(): 完整的单次检测流程（拍摄→检测→处理）
4、串口发送函数
serial_sender(): 串口数据发送线程函数(取队列中最新的6个结果，用 `'7'` 连接起来，形成最终发送的长字符串（如 `"123456712345671234567123456712345671234567"`）。这个设计是为了让下游设备能同时接收到近期历史信息，提高鲁棒性。)


 主程序逻辑
1. 初始化环境（清空目录）
2. 初始化摄像头
3. 获取图像尺寸
4. 加载类别名称
5. 启动串口发送线程
6. 初始拍摄6张照片构建基础结果
7. 进入100次更新循环
8. 清理资源



# 调试问题与解决方案
问题：七月初，遇到光线环境变化时，字母识别不稳定的情况
现象：
  纸垛由于光照原因（例如白天kb未开灯的环境下），字母识别结果容易出错。
解决方案：
1. 通过csdn上拓展数据集的代码，加入经过光影变化的数据再次训练
2、因为字母在场地上位置固定，所以可以通过检测结果处理函数进行约束。




**关于`detect.py`的改动**：尝试在`detect.py`中优化模型加载逻辑以减少调用延迟，节约YOLOv5模型加载时间，但优化效果不明显，且时间紧张没进一步探索。同时，和其他队伍交流后发现代码所用逻辑差不多，他们速度快在使用s模型，当时我的视觉识别在正常光线下识别输出的准确率是百分之百（联调过程中从未出现识别错误的问题），就打算继续使用m模型进行识别。

